<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CRM AR+ ‚Äî –ö–ª–∏–µ–Ω—Ç—ã</title>
<script src="qrc:///qtwebchannel/qwebchannel.js"></script>
<style>
body { margin:0; font-family:Poppins,sans-serif; background:#2c2c2c; color:#fff; }
.sidebar { position:fixed; left:0; top:0; width:220px; height:100%; background:#1a1a1a; padding-top:30px; display:flex; flex-direction:column; align-items:center; box-shadow:2px 0 10px rgba(0,0,0,0.5); }
.sidebar h1 { font-size:32px; color:#00bfff; margin:0 0 30px 0; }
.menu { width:100%; display:flex; flex-direction:column; align-items:center; }
.menu button { width:90%; margin:8px 0; padding:14px; border:none; border-radius:12px; background:rgba(0,191,255,0.3); color:#fff; cursor:pointer; transition:0.3s; backdrop-filter:blur(5px); }
.menu button:hover { background:rgba(0,191,255,0.6); transform:translateX(5px); box-shadow:0 4px 12px rgba(0,191,255,0.4); }

.main { margin-left:220px; padding:30px; }
.top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.top-bar button { padding:10px 20px; border:none; border-radius:8px; background:#00bfff; color:#fff; cursor:pointer; transition:0.3s; }
.top-bar button:hover { background:#00e0ff; transform:translateY(-2px); }
.top-bar input { padding:10px; border-radius:8px; border:none; outline:none; width:200px; }

.client-list { display:flex; flex-direction:column; }
.client-item { padding:12px; border-bottom:1px solid #444; display:flex; justify-content:space-between; align-items:center; }
.client-info { display:flex; flex-direction:column; }
.client-actions button { margin-left:5px; padding:4px 8px; border:none; border-radius:4px; cursor:pointer; }
.edit-btn { background:#00bfff; color:#fff; }
.delete-btn { background:#ff5555; color:#fff; }

.empty { color:#ccc; text-align:center; margin-top:50px; font-size:18px; }

.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
.modal-content { background:#1a1a1a; padding:20px; border-radius:10px; width:400px; display:flex; flex-direction:column; }
.modal-content input, .modal-content textarea { margin-bottom:10px; padding:10px; border-radius:6px; border:none; outline:none; width:100%; background:#2c2c2c; color:#fff; }
.modal-content button { padding:10px; border:none; border-radius:6px; background:#00bfff; color:#fff; cursor:pointer; transition:0.3s; }
.modal-content button:hover { background:#00e0ff; }
</style>
</head>
<body>

<div class="sidebar">
<h1>CRM AR+</h1>
<div class="menu">
<button>–ó–∞–∫–∞–∑-–Ω–∞—Ä—è–¥—ã</button>
<button>–ö–ª–∏–µ–Ω—Ç—ã</button>
<button>–ó–∞–¥–∞—á–∏</button>
<button>–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</button>
<button>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
<button>–í—ã—Ö–æ–¥</button>
</div>
</div>

<div class="main">
<div class="top-bar">
<button id="new-client-btn">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</button>
<input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤...">
</div>

<div id="client-list" class="client-list">
<div class="empty">–ü—É—Å—Ç–æ</div>
</div>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<input type="text" id="name" placeholder="–ò–º—è">
<input type="text" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
<input type="text" id="car" placeholder="–ê–≤—Ç–æ–º–æ–±–∏–ª—å">
<input type="text" id="plate" placeholder="–ì–æ—Å. –Ω–æ–º–µ—Ä">
<textarea id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
<button id="save-client">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>

<script>
let pywebchannel = null;
let editId = null;

const modal = document.getElementById("modal");
const newBtn = document.getElementById("new-client-btn");
const saveBtn = document.getElementById("save-client");
const nameInput = document.getElementById("name");
const phoneInput = document.getElementById("phone");
const carInput = document.getElementById("car");
const plateInput = document.getElementById("plate");
const commentInput = document.getElementById("comment");
const clientList = document.getElementById("client-list");

new QWebChannel(qt.webChannelTransport, function(channel) {
    pywebchannel = channel.objects.pywebchannel;
    pywebchannel.clients_updated.connect(updateClients);
    pywebchannel.load_clients();
});

newBtn.onclick = () => {
    editId = null;
    modal.style.display = "flex";
    nameInput.value = phoneInput.value = carInput.value = plateInput.value = commentInput.value = "";
}

saveBtn.onclick = () => {
    const name = nameInput.value.trim();
    const phone = phoneInput.value.trim();
    const car = carInput.value.trim();
    const plate = plateInput.value.trim();
    const comment = commentInput.value.trim();

    if (!name) { alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è"); return; }

    if (editId) {
        pywebchannel.edit_client(editId, name, phone, car, plate, comment);
    } else {
        pywebchannel.add_client(name, phone, car, plate, comment);
    }
    modal.style.display = "none";
}

function editClient(id, name, phone, car, plate, comment) {
    editId = id;
    nameInput.value = name;
    phoneInput.value = phone;
    carInput.value = car;
    plateInput.value = plate;
    commentInput.value = comment;
    modal.style.display = "flex";
}

function deleteClient(id) {
    if (confirm("–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?")) pywebchannel.delete_client(id);
}

function updateClients(clients) {
    clientList.innerHTML = "";
    if (clients.length === 0) {
        clientList.innerHTML = `<div class="empty">–ü—É—Å—Ç–æ</div>`;
        return;
    }

    clients.forEach(c => {
        const div = document.createElement("div");
        div.className = "client-item";
        div.innerHTML = `
            <div class="client-info">
                <strong>${c[1]}</strong> | ${c[2]} | ${c[3]} | ${c[4]}<br>
                <small>${c[5]}</small>
                <small style="color:#888;">–°–æ–∑–¥–∞–Ω: ${c[6]}</small>
            </div>
            <div class="client-actions">
                <button class="edit-btn" onclick="editClient(${c[0]}, '${c[1]}', '${c[2]}', '${c[3]}', '${c[4]}', '${c[5]}')">‚úé</button>
                <button class="delete-btn" onclick="deleteClient(${c[0]})">üóë</button>
            </div>
        `;
        clientList.appendChild(div);
    });
}

window.onclick = e => { if (e.target === modal) modal.style.display = "none"; }
</script>
</body>
</html>
